ĐỒ ÁN TỐT NGHIỆP ĐIỀU KHIỂN VÀ GIÁM SÁT HỆ THỐNG BÁO CHÁY TỪ XA BẰNG TIN NHẮN SMS ĐỀ TÀI: ĐỒ ÁN TỐT NGHIỆP ĐIỀU KHIỂN VÀ GIÁM SÁT HỆ THỐNG BÁO CHÁY TỪ XA BẰNG TIN NHẮN SMS Khoa Điện Tử Viễn Thông, Trường Đại học Bách Khoa, Đại học Đà Nẵng Khoa Điện Tử Viễn Thông, Trường Đại họcBách Khoa, Đại học Đà Nẵng LỜI MỞ ĐẦU ĐỒ ÁN TỐT NGHIỆP ĐIỀU KHIỂN VÀ GIÁM SÁT HỆ THỐNG BÁO CHÁY TỪ XA BẰNG TIN NHẮN SMS Ngày nay, với sự phát triển vượt bậc của khoa học kỹ thuật, điện tử đã được ứng dụng ở rất nhiều lĩnh vực trong thực tế để phục vụ nhu cầu, chăm sóc sức khỏe, bảo vệ tính mạng và tài sản của con người. Qua tìm hiểu thực tế em đã thấy được rằng gần đây rất nhiều vụ nổ bình gas thương tâm đã xảy ra gây thiệt hại rất lớn về người và của. Mặt khác, nhiều vụ cháy lớn không được cảnh báo và phát hiện kịp thời đã thiêu trụi và phá hủy gần như toàn bộ tài sản và đe dọa đến tính mạng con người. Khi mà cuộc sống hiện đại ngày nay bình gas là nhiên liệu đốt không thể thiếu trong mỗi gia đình, các nguy cơ cháy nổ luôn luôn thường trực, mối đe dọa về một thảm họa có thể xảy đến bất cứ lúc nào. Từ đó, em đã tìm hiểu và thiết kế hệ thống cảnh báo rò rỉ khí gas và báo cháy thông qua mạng điện thoại GSM rất phổ biến hiện nay để giảm thiểu tối đa hậu quả của chúng gây ra cho con người. Nguyên lý hoạt động của hệ thống : khi có rò rỉ khí gas hoặc nhiệt độ cao bất thường, các sensor cảm biến nồng độ khí gas và nhiệt độ sẽ phát hiện, gửi thông số điện áp tương ứng tới vi điều khiển. Vi điều khiển sẽ phân tích tín hiện nhận về, kích hoạt hệ thống phòng ngừa tương ứng và gửi tin nhắn, điện thoại tới người sử dụng.. Hiện nay, do nhu cầu sử dụng các hệ thống, thiết bị tự động của người dân ngày càng tăng. Đồng thời, mạng điện thoại di động phát triển rộng khắp và các thiết bị điện thoại di động ngày càng có mức giá phù hợp với người dân. Đó là những mặt thuận lợi của việc hình thành ý tưởng điều khiển các thiết bị bằng cách sử dụng các tin nhắn SMS. Đây là một hình thức điều khiển thiết bị thuận lợi, tiết kiệm được nhiều thời gian cho việc điều khiển thiết bị, vừa tiết kiệm được chi phí lắp đặt khi sử dụng. Xuất phát từ ý tưởng và tình hình thực tế nêu trên, chúng em quyết định chọn đề tài “ĐIỀU KHIỂN THIẾT BỊ TỪ XA BẰNG TIN NHẮN SMS”. LỜI CẢM ƠN Trên con đường học vấn của mình, tới nay em đã đi qua bao chặng đường từ tiểu học, trung học cơ sở, trung học phổ thông và hiện bây giờ là giảng đường Đại Học. Và cứ đi qua mỗi chặng đường như vậy thì em lại như được lớn hơn, trưởng thành hơn cả trong kiến thức chuyên sâu lẫn trong suy nghĩ. Với em thì môi trường Đại Học Bách Khoa với quãng thời gian dài 3 năm đã trở thành một khoảng thời gian không thể nào quên. Ở ngôi trường này, chúng em đã tiếp thu, học tập được biết bao những kiến thức chuyên môn trong lĩnh vực khoa học kỹ thuật. Không những thế Đại Học Bách Khoa còn là nơi cho chúng em tôi luyện, rèn giũa ngọn lửa tinh thần, lòng say mê khoa học. Hơn thế nữa, tất cả những điều đó sẽ trở thành hành trang tốt cho chúng em, để cho chúng em thêm vững bước trên con đường sự nghiệp của mình. Em xin gửi lời cảm ơn sâu sắc tới thầy Nguyễn Duy Nhật Viễn. Thầy đã trực tiếp hướng dẫn, theo sát, ân cần chỉ bảo chúng em từng bước, kịp thời một cách nhiệt tình từ khi bắt đầu đồ án cho tới khi hoàn thành đồ án. Bên cạnh đó, gia đình đã trở thành nguồn động viên to lớn về vật chất lẫn tinh thần không thể thiếu giúp em thêm can đảm, tự tin để hoàn thành đồ án này. Xin gửi lời biết ơn vô vàn tới cha, mẹ đã luôn ủng hộ con trong suốt thời gian làm đồ án. Cuối cùng là lời cảm ơn chân thành tới các bạn cùng lớp đã có những giúp đỡ kịp thời, những đóng góp ý kiến thật lòng trong suốt thời gian làm đồ án, giúp cho đồ án hoàn thiện hơn. MỤC LỤC Chương 1: TỔNG QUAN VỀ HỆ THỐNG.. 1 1.1 Giới thiệu:1 1.2 Sơ đồ khối của hệ thống:1 1.2.1Khối điều khiển :1 1.2.2Khối cảm biến :1 1.2.3Khối hiển thị :1 Chương 2: TÌM HIỂU VÀ CHỌN LINH KIỆN.. 3 2.1 Giới thiệu:3 2.2 Vi điều khiển PIC 16F887:3 2.2.1 Giới thiệu:3 2.3 Cảm biến nhiệt độ - LM35:11 2.3.1 Hình dạng thực tế:11 2.3.2 Đặc điểm:11 2.4 Cảm biến khí gas – MQ6:12 2.4.1 Hình dạng thực tế:12 2.4.2 Sơ đồ cấu tạo và cách mắc:12 2.4.3 Các thông số kĩ thuật:13 2.5 Module Sim:14 2.5.1 Giới thiệu:14 2.5.2 Đặc điểm kĩ thuật:15 2.6 LCD 16x2:16 2.6.1 Tổng quát:16 2.6.2 Chức năng các chân:17 2.7 IC Max232:18 2.7.1 Giới thiệu:18 2.7.2Sơ đồ chân. 19 2.7.3Mạch cơ bản:19 2.7.4 Các ứng dụng của MAX232.............................................................................. 19 2.7.5 Các thông số kĩ thuật của MAX232................................................................. 20 2.8 Cổng COM DB9.......................................................................................................... 20 2.9 Triac............................................................................................................................. 21 2.10 MOC3020............................................................................................................. 21 2.11 Kết luận chương................................................................................................... 22 Chương 3: THIẾT KẾ MẠCH.. 23 3.1 Giới thiệu chương:23 3.3.3 Tính toán thiết kế:26 3.4 Mạch công suất:29 3.4.1 Nhiệm vụ:29 3.4.2 Sơ đồ mạch:29 3.4.3 Nguyên lý:30 3.4.4 Tính toán:30 3.5 Mạch LCD:31 3.6 Mạch nguồn:31 3.7 Kết luận chương:32 Chương 4: THI CÔNG VÀ KIỂM TRA MẠCH.. 32 4.1 Giới thiệu chương:33 4.2 Vẽ Layout sử dụng phần mềm Orcad:33 4.2.1 Khối mạch chính:33 4.2.2 Khối Module Sim:34 4.2.3 Khối công suất:35 4.2.4 Khối hiển thị:35 4.3 Lắp ráp mạch - kiểm tra hoạt động của mạch:36 Chương 5: PHẦN MỀM ĐIỀU KHIỂN CHO PIC.. 37 5.1 Chương trình chính:37 5.2 Lưu đồ thuật toán chương trình nhận và sử lí tin nhắn:37 5.3 Lưu đồ thuật toán chương trình kiểm tra nhiệt độ:40 5.4 Lưu đồ thuật toán chương trình kiểm tra khí GAS:41 5.5 Lưu đồ thuật toán bật hệ thống giám sát khi đi vắng:42 5.6 Kết luận chương:42 KẾT LUẬN VÀ HƯỚNG PHÁT TRIỂN ĐỀ TÀI. 43 DANH MỤC CÁC HÌNH Hình 1.1. Sơ đồ khối hệ thống............................................................................................... 1 Hình 2.1. PIC............................................................................................................................ 4 Hình 2.2.Trúc bên trong của PIC 16F887.......................................................................... 8 Hình 2.3. Cảm biến nhiệt LM35.......................................................................................... 11 Hình 2.4 Cảm biến khí Gas MQ6........................................................................................ 12 Hình 2.5. Sơ đồ cấu tạo và cách mắc MQ6....................................................................... 12 Hình 2.6. Sự phụ thuộc của Rs vào nồng độ khí gas........................................................ 13 Hình 2.7. Sự phụ thuộc của Rs vào nhiệt độ môi trường................................................. 13 Hình 2.8. Hình dạng thực tế module Sim 548C................................................................. 14 Hình 2.9. Sơ đồ khối chức năng module SIM 548C......................................................... 15 Hình 2.10 Sơ đồ chân LCD 16x2......................................................................................... 17 Hình 2.11. Sơ đồ chân MAX232.......................................................................................... 19 Hình 2.12. Sơ đồ mạch MAX232......................................................................................... 19 Hình 2.13. Sơ đồ chân cổng COM DB9.............................................................................. 20 Hình 2.14. Sơ đồ chân BT138.............................................................................................. 21 Hình 2.15. Sơ đồ chân MOC3020....................................................................................... 21 Hình 3.1. Sơ đồ mạch chính................................................................................................. 24 Hình 3.2. Sơ đồ tổng thể khối Module Sim........................................................................ 25 Hình 3.3. Sơ đồ mạch nguồn cho Sim 548C...................................................................... 26 Hình 3.4. Sơ đồ chi tiết mạch Sim 548C............................................................................. 27 Hình 3.5. Sơ đồ mạch khối Led hiển thị............................................................................. 28 Hình 3.6. Sơ đồ mạch công suất.......................................................................................... 29 Hình 3.7. Sơ đồ mạch LCD 16x2......................................................................................... 31 Hình 3.8. Sơ đồ mạch nguồn 5VDC.................................................................................... 31 Hình 3.9. Sơ đồ mạch nguồn 3.3VDC................................................................................. 32 Hình 4.1. Layout khối mạch chính...................................................................................... 33 Hình 4.2. Layout khối Module Sim 548C........................................................................... 34 Hình 4.3. Layout khối công suất......................................................................................... 35 Hình 4.4. Layout khối hiển thị............................................................................................. 35 Hình 5.1. Chương trình chính.............................................................................................. 37 Hình 5.2. Lưu đồ thuật toán chương trình ngắt RDA...................................................... 38 Hình 5.3. Lưu đồ chương trình con kiểm tra..................................................................... 38 Hình 5.4. Lưu đồ thuật toán chương trình gửi tin............................................................ 39 Hình 5.5. Lưu đồ thuật toán chương trình kiểm tra nhiệt độ.......................................... 40 Hình 5.6. Lưu đồ thuật toán chương trình kiểm tra Gas................................................. 41 Hình 5.7. Lưu đồ thuật toán chương trình bật PIR........................................................... 42 Phụ lục Mã nguồn……………………………………………………………………………..47 [1] Datasheet PIC 16f887 57 [2] Datasheet Module Sim 548C [3] Datasheet MOC3020 [4] Datasheet BT138 [5] Datasheet MAX232 [6] www.google.com.vn [7] www.diendanti.com.vn [8] www.tme.vn (pir và gas) CHƯƠNG 1: TỔNG QUAN VỀ HỆ THỐNG 1.1 Giới thiệu: Với yêu cầu của hệ thống, em đi vào xây dựng sơ đồ khối cho hệ thống gồm có 7 khối sẽ được trình bày cụ thể ở các mục sau. 1.2 Sơ đồ khối của hệ thống: Hình 1.1. Sơ đồ khối hệ thống 1.2.1 Khối điều khiển : Nhận dữ liệu đầu vào từ các cảm biến, phân tích và xử lý dữ liệu, hiển thị nhiệt độ và cảnh báo có khí gas lên LCD, ra lệnh cho module sim gửi tin nhắn và gọi điện cho người sử dụng nếu có sự cố xảy ra đồng thời kích hoạt hệ thống phòng ngừa. 1.2.2 Khối cảm biến : Cảm biến nhiệt độ môi trường và nồng độ khí gas trong không khí đưa tới đầu vào của vi điều khiển. 1.2.3 Khối hiển thị : Hiển thị nhiệt độ môi trường, hiển thị cảnh báo khi có nhiệt độ cao và khi có nồng độ khí ga trong không khí. 1.2.4 Module sim 548C: Gửi tin nhắn và gọi điện tới người sử dụng hệ thống khi có sự cố xảy ra. 1.2.5 Khối công suất : Hệ thống phòng ngừa tức thời khi xảy ra sự cố, được điều khiển on/off bởi vi điều khiển. 1.2.6 Nguồn cung cấp : Cung cấp nguồn cho hệ thống hoạt động, gồm có : - Nguồn vi điều khiển. - Nguồn cảm biến nhiệt độ. - Nguồn cảm biến khí gas. - Nguồn Module sim. - Nguồn Max 232. 1.3 Kết luận chương Dựa vào sơ đồ khối của hệ thống, em sẽ đi tìm hiểu chọn linh kiện, xây dựng mạch để thực hiện nhiệm vụ của từng khối. CHƯƠNG 2: TÌM HIỂU VÀ CHỌN LINH KIỆN 2.1 Giới thiệu: Qua tìm hiểu thực tế, với tiêu chí về độ chính xác, giá thành, tính thông dụng và có sẵn của linh kiện, trên cơ sở lý thuyết đã được học em đã quyết định chọn các linh kiện chính sử dụng trong mạch như sau: - Vi điều khiển - PIC 16F887 - Cảm biến nhiệt độ - LM35. - Cảm biến khí gas - MQ6. - Module sim 548C 2.2 Vi điều khiển PIC 16F887: 2.2.1 Giới thiệu: PIC16F887 là nhóm PIC trong họ PIC16XX của họ Vi điều khiển 8-bit, tiêu hao năng lượng thấp, đáp ứng nhanh, chế tạo theo công nghệ CMOS, chống tĩnh điện tuyệt đối Tất cả các PIC16/17 đều có cấu trúc RISC. PIC16CXX các đặc tính nổi bậc, 8 mức ngăn xếp Stack, nhiều nguồn ngắt tích hợp bên trong lẫn ngoài. Có cấu trúc Havard với các bus dữ liệu và bus thực thi chương trình riêng biệt nhau cho phép độ dài 1 lệnh là 14-bit và bus dữ liệu 8-bit cách biệt nhau. Tất cả các lệnh đều mất 1 chu kỳ lệnh ngoại trừ các lệnh rẽ nhánh chương trình mất 2 chu kỳ lệnh. Chỉ có 35 lệnh và 1 lượng lớn các thanh ghi cho phép đáp ứng cao trong ứng dụng. Họ PIC16F8X có nhiều tính năng đặc biệt làm giảm thiểu các thiết bị ngoại vi, vì vậy kinh tế cao, có hệ thống nổi bật đáng tin cậy và sự tiêu thụ năng lượng thấp. Ở đây có 4 sự lựa chọn bộ dao dộng và chỉ có 1 chân kết nối bộ dao động RC nên có giải pháp tiết kiệm cao. Chế độ SLEEP tiết kiệm nguồn và có thể được đánh thức bởi các nguồn reset. Và còn nhiều phần khác đó được giới thiệu bên trên sẽ được nói rõ ở các phần kế tiếp. 2.2.2 PIC 16F877: PIC16F877A có 40/44 chân với sự phân chia cấu trúc như sau Có 5 port xuất/nhập Có 8 kênh chuyển đổi A/D 10-bit Có bộ nhớ gấp đôi so với PIC16F873A và PIC16F874A2.2.1Tóm tắt đặc điểm của PIC16F887 Tần số hoạt động DC-20MHz Reset và Delay POR, BOR (PWRT, OST) Bộ nhớ chương trình Flash (14-bit word) 8K 8K Bộ nhớ dữ liệu (byte) 368 Bộ nhớ dữ liệu EEPROM (byte) 256 Các ngắt 15 Các Port xuất/nhập Port A, B, C, D, E Timer 3 Module Capture/Compare/PWM 2 Giao tiếp nối tiếp MSSP, USART Giao tiếp song song PSP Module A/D 10-bit 8 kênh ngõ vào Bộ so sánh tương tự 2 Tập lệnh 35 lệnh Số chân 40 chân PDIP Sơ đồ chân, cấu trúc và chức năng PIC16F887 loại 40 chân PDIP : Hình 2.1. PIC vChức năng các chân: Chân OSC1/CLKI (13) : ngõ vào dao động thạch anh hoặc xung clock bên ngoài. - OSC1 : ngõ vào dao động thạch anh hoặc xung clock bên ngoài. Ngõ vào Schmit trigger khi được cấu tạo ở chế độ RC ; một cách khác của CMOS. - CLKI : ngõ vào nguồn xung bên ngoài. Luôn được kết hợp với chức năng OSC1. Chân OSC2/CLKO (14) : ngõ vào dao động thạch anh hoặc xung clock - OSC2 : Ngõ ra dao động thạch anh. Kết nối đến thạch anh hoặc bộ cộng hưởng. - CLKO : ở chế độ RC, ngõ ra của OSC2, bằng tần số của OSC1 và chỉ ra tốc độ của chu kỳ lệnh. Chân /Vpp (1) : - : hoạt độn reset ở mức thấp . - VPP: ngõ vào áp lập trình. Chân RA0/AN0 (2) . - RA0 : xuất/nhập số. - AN0 : ngõ vào tương tự 0. Chân RA1/NA1 (3) : - RA1 : xuất/nhập số. - AN1 : ngõ vào tương tự 1. Chân RA2/NA2/VREF-/CVREF/C2IN+(4) : - RA2 : xuất/nhập số - AN2 : ngõ vào tương tự 2 - VREF -: ngõ vào điện áp chuẩn (thấp) của bộ A/D - CVREF: điện áp tham chiếu VREFngõ ra bộ so sánh. Chân RA3/NA3/VREF+/ C1IN+ (5) : - RA3 : xuất/nhập số. - AN3 : ngõ vào tương tự 3. - VREF+ : ngõ vào điện áp chuẩn (cao) của bộ A/D. Chân RA4/TOCKI/C1OUT (6) : - RA4 : xuất/nhập số - mở khi được cấu tạo như ngõ ra. - TOCKI : ngõ vào xung clock bên ngoài cho Timer 0. - C1 OUT : Ngõ ra bộ so sánh 1. Chân RA5/AN4//C2OUT (7) : RA5 : xuất/nhập số. - AN4 : ngõ vào tương tự 4. - : ngõ vào chọn lựa SPI phụ. - C2 OUT : ngõ ra bộ so sánh 2. RB0/AN12/INT (33) : - RB0 : xuất/nhập số - INT : ngắt ngoài RB1/AN10/C12IN3-/(34) : - RB1 : xuất/nhập số RB2/AN8 (35) : - RB2 : xuất/nhập số RB3/AN9/PGM / C12IN2-: - RB3 : xuất/nhập số. RB4 (37), RB5 (38) : xuất/nhập số RB6/ICSPCLK (39) : - RB6 : xuất/nhập số. RB7/ICSPDAT (40) : - RB7 : xuất/nhập số. Chân RC0/T1 OCO/T1CKI (15) : - RC0 : xuất/nhập số. - T1 OCO : ngõ vào bộ dao động Timer 1. - T1 CKI : ngõ vào xung clock bên ngoài Timer 1. Chân RC1/T1 OSI/CCP2 (16) : - RC1 : xuất/nhập số - T1 OSI : ngõ vào bộ dao động Timer 1 - CCP2 : ngõ vào Capture 2, ngõ ra compare 2, ngõ ra PWM2 Chân RC2/P1A/CCP1 (17) : - RC2 : xuất/nhập số. - CCP1 : ngõ vào Capture 1, ngõ ra compare 1, ngõ ra PWM1 Chân RC3/SCK/SCL (18): - RC3 : xuất/nhập số. - SCK : ngõ vào xung clock nối tiếp đồng bộ/ngõ ra của chế độ SPI. - SCL : ngõ vào xung clock nối tiếp đồng bộ/ ngõ ra của chế độ I2C Chân RC4/SDI/SDA (23) : - RC4 : xuất/nhập số. - SDI : dữ liệu vào SPI. - SDA : xuất/nhập dữ liệu vào I2C. Chân RC5/SDO (24) : - RC5 : xuất/nhập số. - SDO : dữ liệu ra SPI. Chân RC6/TX/CK (25) : - RC6 : xuất/nhập số. - TX : truyền bất đồng bộ USART. - CK : xung đồng bộ USART. Chân RC7/RX/DT (26) : - RC7 : xuất/nhập số. - RX : nhận bất đồng USART. - DT : dữ liệu đồng bộ USART. Các chân RD0 (19) ,RD1 (20), RD2 (21), RD3 (22): xuất/nhập số. Các Chân RD4,RD5/P1B (28), RD6/P1C (29),RD7/P1D (30) Chân RE1/AN6 (9) : - RE1 : xuất/nhập số. - AN6 : ngõ vào tương tự 6. Chân RE2/AN7 (10) : - RE2 : xuất/nhập số. - AN7 : ngõ vào tương tự 7 vSơ đồ cấu trúc bên trong của PIC 16F887 : Hình 2.2. Trúc bên trong của PIC 16F887 Các cổng xuất nhập của PIC16F887: Cổng xuất nhập (I/O port) chính là phương tiện mà vi điều khiển dùng để tương tác với thế giới bên ngoài. Bên cạnh đó, do vi điều khiển được tích hợp sẵn bên trong các đặc tính giao tiếp ngoại vi nên bên cạnh chức năng là cổng xuất nhập thông thường, một số chân xuất nhập còn có thêm các chức năng khác để thể hiện sự tác động của các đặc tính ngoại vi nêu trên đối với thế giới bên ngoài. Vi điều khiển PIC16F887 có 5 cổng xuất nhập, bao gồm PORTA, PORTB, PORTC, PORTD và PORTE. vPORT A: PORTA (RPA) bao gồm 6 I/O pin. Đây là các chân “hai chiều” (bidirectional pin), nghĩa là có thể xuất và nhập được. Chức năng I/O này được điều khiển bởi thanh ghi TRISA (địa chỉ 85h). Muốn xác lập chức năng của một chân trong PORTA là input, ta “set” bit điều khiển tương ứng với chân đó trong thanh ghi TRISA và ngược lại, muốn xác lập chức năng của một chân trong PORTA là output, ta “clear” bit điều khiển tương ứng với chân đó trong thanh ghi TRISA. Thao tác này hoàn toàn tương tự đối với các PORT và các thanh ghi điều khiển tương ứng TRIS (đối với PORTA là TRISA, đối với PORTB là TRISB, đối với PORTC là TRISC, đối với PORTD là TRISD vàđối với PORTE là TRISE). Bên cạnh đó PORTA còn là ngõ ra của bộ ADC, bộ so sánh, ngõ vào analog ngõ vào xung clock của Timer0 và ngõ vào của bộ giao tiếp MSSP (Master Synchronous Serial Port). Các thanh ghi SFR liên quan đến PORTA bao gồm: PORTA (địa chỉ 05h) : chứa giá trị các pin trong PORTA. TRISA (địa chỉ 85h) : điều khiển xuất nhập. CMCON (địa chỉ 9Ch) : thanh ghi điều khiển bộ so sánh. CVRCON (địa chỉ 9Dh) : thanh ghi điều khiển bộ so sánh điện áp. ADCON1 (địa chỉ 9Fh) : thanh ghi điều khiển bộ ADC. vPORT B: PORTB (RPB) gồm 8 pin I/O. Thanh ghi điều khiển xuất nhập tương ứng là TRISB. Bên cạnh đó một số chân của PORTB còn được sử dụng trong quá trình nạp chương trình cho vi điều khiển với các chế độ nạp khác nhau. PORTB còn liên quan đến ngắt ngoại vi và bộ Timer0. PORTB còn được tích hợp chức năng điện trở kéo lên được điều khiển bởi chương trình. Các thanh ghi SFR liên quan đến PORTB bao gồm: PORTB (địa chỉ 06h,106h) : chứa giá trị các pin trong PORTB OPTION_REG (địa chỉ 81h,181h) : điều khiển ngắt ngoại vi và bộ Timer0. vPORT C: PORTC (RPC) gồm 8 pin I/O. Thanh ghi điều khiển xuất nhập tương ứng là TRISC. Bên cạnh đó PORTC còn chứa các chân chức năng của bộ so sánh, bộ Timer1, bộ PWM và các chuẩn giao tiếp nối tiếp I2C, SPI, SSP, USART. Các thanh ghi điều khiển liên quan đến PORTC: PORTC (địa chỉ 07h) : chứa giá trị các pin trong PORTC TRISC (địa chỉ 87h) : điều khiển xuất nhập. vPORT D: PORTD (RPD) gồm 8 chân I/O, thanh ghi điều khiển xuất nhập tương ứng là TRISD. PORTD còn là cổng xuất dữ liệu của chuẩn giao tiếp PSP (Parallel Slave Port). Các thanh ghi liên quan đến PORTD bao gồm: Thanh ghi PORTD : chứa giá trị các pin trong PORTD. Thanh ghi TRISD : điều khiển xuất nhập. vPORT E: PORTE (RPE) gồm 3 chân I/O. Thanh ghi điều khiển xuất nhập tương ứng là TRISE. Các chân của PORTE có ngõ vào analog. Bên cạnh đó PORTE còn là các chân điều khiển của chuẩn giao tiếp PSP. Các thanh ghi liên quan đến PORTE bao gồm: PORTE : chứa giá trị các chân trong PORTE. TRISE : điều khiển xuất nhập và xác lập các thông số cho chuẩn giao tiếp PSP. ADCON1 : thanh ghi điều khiển khối ADC. ADC : ADC (Analog to Digital Converter) là bộ chuyển đổi tín hiệu giữa hai dạng tương tự và số. PIC16F887 có 8 ngõ vào analog (RA4:RA0 và RE2:RE0). Hiệu điện thế chuẩn VREF có thể được lựa chọn là VDD, VSS hay hiệu điện thể chuẩn được xác lập trên hai chân RA2 và RA3. Kết quả chuyển đổi từ tín tiệu tương tự sang tín hiệu số là 10 bit số tương ứng và được lưu trong hai thanh ghi ADRESH:ADRESL. Các thanh ghi liên quan đến bộ chuyển đổi ADC bao gồm: INTCON (địa chỉ 0Bh, 8Bh, 10Bh, 18Bh): cho phép các ngắt (các bit GIE, PEIE). PIR1 (địa chỉ 0Ch): chứa cờ ngắt AD (bit ADIF). PIE1 (địa chỉ 8Ch): chứa bit điều khiển AD (ADIE). ADRESH (địa chỉ 1Eh) và ADRESL (địa chỉ 9Eh): các thanh ghi chứa kết quả chuyển đổi AD. ADCON0 (địa chỉ 1Fh) và ADCON1 (địa chỉ 9Fh): xác lập các thông số cho bộ chuyển đổi AD. PORTA (địa chỉ 05h) và TRISA (địa chỉ 85h): liên quan đến các ngõ vào analog ở PORTA. PORTE (địa chỉ 09h) và TRISE (địa chỉ 89h): liên quan đến các ngõ vào analog ở PORTE. 2.3 Cảm biến nhiệt độ - LM35: 2.3.1 Hình dạng thực tế: Hình 2.3. Cảm biến nhiệt LM35 Cảm biến LM35 là cảm biến nhiệt mạch tích hợp chính xác cao mà điện áp đẩu ra của nó tỉ lệ tuyến tính với nhiệt độ theo thang nhiệt độ Celcius. 2.3.2 Đặc điểm: Điện áp đầu vào từ 4v-30v. Độ phân giải điện áp đầu ra là 10mV/1oC Khoảng nhiệt độ hoạt động từ -55oC đến 150oC Trở kháng đầu ra thấp : 0.1Ω cho 1mA tải Độ chính xác cao : ở 25oC là 0.5oC Một số mức điện áp ra tương ứng với nhiệt độ: Nhiệt độ -55oC điện áp đầu ra là -550mV Nhiệt độ 25oC điện áp đầu ra là 250mV Nhiệt độ 150oC điện áp đầu ra là 1500mV 2.4 Cảm biến khí gas – MQ6: 2.4.1 Hình dạng thực tế: Hình 2.4 Cảm biến khí Gas MQ6 MQ6 là cảm ứng khí gas sử dụng SnO2 ,dựa vào sự thay đổi khả năng dẫn điện của SnO2 khi nồng độ khí gas và các chất khí dễ cháy khác thay đổi. Khi nồng độ càng tăng thì độ dẫn điện sẽ càng tăng, điện trở của cảm biến giảm. 2.4.2 Sơ đồ cấu tạo và cách mắc: Hình 2.5. Sơ đồ cấu tạo và cách mắc MQ6 Điện áp lấy ra trên chân A (hoặc B) của cảm biến giống như điện áp lấy ra ở cầu phân áp. Điện trở Rs của cảm biến thay đổi làm cho giá trị điện áp trên đầu ra này thay đổi, tùy thuộc vào nồng độ khí gas trong không khí ở nơi đặt cảm biến mà ta có các giá trị Vout khác nhau. Điện trở RLđược chọn nằm trong khoảng từ 10K đến 20K. 2.4.3 Các thông số kĩ thuật: Biểu đồ chỉ sự phụ thuộc của Rs vào nồng độ khí gas và nhiệt độ môi trường : Hình 2.6. Sự phụ thuộc của Rs vào nồng độ khí gas Hình 2.7. Sự phụ thuộc của Rs vào nhiệt độ môi trường R0: điện trở cảm biến ở 20ºC, 1000ppm, 65%RH Tầm đo nồng độ gas: 300ppm – 10000ppm (ppm: part per milion) RH= 33 Ω ± 5% giá trị đo được là RH = 30 Ω PH ≤ 900mW RS=RAB= 10KΩ - 60KΩ (1000ppm LPG ) Rs(in air)/Rs(1000ppm C3H8 )≥5 Theo mạch, đo được RS=15 KΩ (in air) Theo đồ thị ta thấy: điện trở của cảm biến trong không khí ở điều kiện bình thường gấp 10 lần ở 1000ppm suy ra điện trở ở RS ở 1000ppm khoảng 1,5KΩ . Ở 2000ppm Rs = 0.7x1,5 = 1,05 KΩ 2.5 Module Sim: 2.5.1 Giới thiệu: Đây là dạng module combo tích hợp chức năng GSM/GPRS và GPS của hãng sản xuất SIMCOM. Hình 2.8. Hình dạng thực tế module Sim 548C Module Sim548C hỗ trợ hoạt động trên 4 băng tần, đồng thời tích hợp công nghệ GPS cho điều hướng vệ tinh. Phiên bản thiết kế mới của module Sim 548C cho phép dễ dàng ứng dụng trong các giải pháp tích hợp, giúp ta có thể tiết kiệm về thời gian và kinh phí cho việc mở rộng các module phần cứng sau này. Điểm đặc trưng cho giao tiếp chuẩn công nghiệp và chức năng GPS, là sự kết hợp giữa 2 công nghệ cho phép hàng hóa, phương tiện và con người, sẽ được theo dõi liên tục tại bất kì thời gian và địa điểm nào. Đặc tính vật lý: + Kích thước tổng thể: 55*33*8.2 mm + Trọng lượng: xấp xỉ 16.5g + Nhiệt độ hoạt động bình thường: từ -30oC đến +80oC. Hình 2.9. Sơ đồ khối chức năng module SIM 548C 2.5.2 Đặc điểm kĩ thuật: Các đặc điểm kĩ thuật về GSM/GPRS - Tính năng chung: + Hoạt động trên 4 băng tần 850/900/1800/1900 MHz + Tốc độ tối đa dữ liệu GPRS ở lớp 10 + Trạm mobile GPRS lớp B + Điều khiển qua tập lệnh AT + Dãy điện áp hoạt động từ 3.4- 4.5V + Công suất tiêu thụ thấp - Chức năng cho SMS thông qua mạng GSM/GPRS + Kết nối điểm nối điểm giữa MO và MT + Chức năng nhận tin nhắn quảng bá + Hỗ trợ chế độ TEXT hoặc PDU - Chức năng audio + Hỗ trợ tricodec + Hỗ trợ chế độ rãnh tay + Loại bỏ tiếng dội - Chức năng cho truyền tải dữ liệu GPRS + GPRS lớp 8/10: tốc độ download cực đại 85.6kbps + Hỗ trợ PBCCH + Lược đồ mã hóa CS 1,2,3,4. + Tích hợp ngăn TCP/IP - Đặc điểm giao tiếp + Chuẩn giao tiếp 60 chân dạng DIP + Giao tiếp SIM ngoài có điện áp 3V hoặc 1.8V + Hỗ trợ 2 kênh audio analog + Điều khiển nối tiếp qua tập lệnh AT + Hỗ trợ sẵn pad hàn đế sim ngay trên thân module + Hỗ trợ giao tiếp LCD và RTC + Tích hợp sẵn 2 cổng giao tiếp nối tiếp cho các phần GSM/GPRS và GPS Các đặc điểm kĩ thuật của GPS + 20 kênh thu, dãy tần số hoạt động L1 1575.42 MHZ, mã hóa C/A, tốc độ chip 1,023MHZ + Tốc độ thu hỗ trợ các chế độ khởi động nóng, khởi động nguội và lạnh. + Hỗ trợ AGPS + Điện áp hoạt động 3,3V DC +/- 5% + Công suất tiêu thụ thấp cỡ 200mW tại mức áp 3.3V + Hỗ trợ các giao thức: o NMEA 0183 o SiRF binary o RTCM SC-104 + Bộ nhớ: 4MB Flash và 1MB SRAM. 2.6 LCD 16x2: 2.6.1 Tổng quát: Ngày nay, thiết bị hiển thị LCD (Liquid Crystal Display) được sử dụng trong rất nhiều các ứng dụng của VĐK. LCD có rất nhiều ưu điểm so với các dạng hiển thị khác: Nó có khả năng hiển thị kí tự đa dạng, trực quan (chữ, số và kí tự đồ họa), dễ dàng đưa vào mạch ứng dụng theo nhiều giao thức giao tiếp khác nhau, tốn rất ít tài nguyên hệ thống và giá thành rẻ … Khi sản xuất LCD, nhà sản xuất đã tích hợp chíp điều khiển (HD44780) bên trong lớp vỏ và chỉ đưa các chân giao tiếp cần thiết. Các chân này được đánh số thứ tự và đặt tên như hình vẽ Hình 2.10 Sơ đồ chân LCD 16x2 2.6.2 Chức năng các chân: Chân Ký hiệu Mô tả 1 Vss Chân nối đất cho LCD, khi thiết kế mạch ta nối chân này với GND của mạch điều khiển 2 VDD Chân cấp nguồn cho LCD, khi thiết kế mạch ta nối chân này với VCC=5V của mạch điều khiển 3 VEE Điều chỉnh độ tương phản của LCD. 4 RS Chân chọn thanh ghi (Register select). Nối chân RS với logic “0” (GND) hoặc logic “1” (VCC) để chọn thanh ghi. + Logic “0”: Bus DB0-DB7 sẽ nối với thanh ghi lệnh IR của LCD (ở chế độ “ghi” - write) hoặc nối với bộ đếm địa chỉ của LCD (ở chế độ “đọc” - read) + Logic “1”: Bus DB0-DB7 sẽ nối với thanh ghi dữ liệu DR bên trong LCD. 5 R/W Chân chọn chế độ đọc/ghi (Read/Write). Nối chân R/W với logic “0” để LCD hoạt động ở chế độ ghi, hoặc nối với logic “1” để LCD ở chế độ đọc. 6 E Chân cho phép (Enable). Sau khi các tín hiệu được đặt lên bus DB0-DB7, các lệnh chỉ được chấp nhận khi có 1 xung cho phép của chân E. + Ở chế độ ghi: Dữ liệu ở bus sẽ được LCD chuyển vào(chấp nhận) thanh ghi bên trong nó khi phát hiện một xung (high-to-low transition) của tín hiệu chân E. + Ở chế độ đọc: Dữ liệu sẽ được LCD xuất ra DB0-DB7 khi phát hiện cạnh lên (low-to-high transition) ở chân E và được LCD giữ ở bus đến khi nào chân E xuống mức thấp. 7 - 14 DB0 - DB7 Tám đường của bus dữ liệu dùng để trao đổi thông tin với MPU. Có 2 chế độ sử dụng 8 đường bus này : + Chế độ 8 bit : Dữ liệu được truyền trên cả 8 đường, với bit MSB là bit DB7. + Chế độ 4 bit : Dữ liệu được truyền trên 4 đường từ DB4 tới DB7, bit MSB là DB7 15 - Nguồn dương cho đèn nền 16 - GND cho đèn nền Ghi chú : Ở chế độ “đọc”, nghĩa là VĐK sẽ đọc thông tin từ LCD thông qua các chân DBx. Còn khi ở chế độ “ghi”, nghĩa là VĐK xuất thông tin điều khiển cho LCD thông qua các chân DBx. 2.7 IC Max232: 2.7.1 Giới thiệu: MAX 232 là 1 mạch tích hợp chuyển đổi tín hiệu từ Port nối tiếp chuẩn RS 232 sang tín hiệu thích hợp để sử dụng trong các mạch số logic chuẩn tương thích TTL. RS232 Line Type & Logic Level RS232 Voltage TTL Voltage to/from MAX232 Data Transmission (Rx/Tx) Logic 0 +3 V to +15 V 0V Data Transmission (Rx/Tx) Logic 1 -3 V to - 15 V 5V Control Signals (RTS/CTS/DTR/DSR) Logic 0 -3 V to - 15 V 5V Control Signals (RTS/CTS/DTR/DSR) Logic 1 +3 V to +15 V 0V 2.7.2 Sơ đồ chân Hình 2.11. Sơ đồ chân MAX232 2.7.3 Mạch cơ bản: Hình 2.12. Sơ đồ mạch MAX232 2.7.4 Các ứng dụng của MAX232: Modem công suất thấp Hệ thống ắc qui- năng lượng RS 232 Mạng đa điểm RS 232 2.7.5 Các thông số kĩ thuật của MAX232: Nguồn cung cấp: +5V. Đặc trưng: tốc độ chuyển đổi cao hơn, đỉnh nhỏ. Giá trị thông thường của tụ là: 1µF. Data rate : 200kbps 2.8 Cổng COM DB9: v DB9 có 9 chân. vKý hiệu chân : Hình 2.13. Sơ đồ chân cổng COM DB9 vChức năng của các chân như sau : Chân 1 : Data Carrier Detect (DCD) : Phát tín hiệu mang dữ liệu. Chân 2: Receive Data (RxD) : Nhận dữ liệu. Chân 3 : Transmit Data (TxD) : Truyền dữ liệu. Chân 4 : Data Termial Ready (DTR) : Đầu cuối dữ liệu sẵn sàng được kích hoạt bởi bộ phận khi muốn truyền dữ liệu. Chân 5 : Singal Ground ( SG) : Mass của tín hiệu. Chân 6 : Data Set Ready (DSR) : Dữ liệu sẵn sàng, được kích hoạt bởi bộ truyền khi nó sẵn sàng nhận dữ liệu. Chân 7 : Request to Send : yêu cầu gửi,bô truyền đặt đường này lên mức hoạt động khi sẵn sàng truyền dữ liệu. Chân 8 : Clear To Send (CTS) : Xóa để gửi ,bô nhận đặt đường này lên mức kích hoạt động để thông báo cho bộ truyền là nó sẵn sàng nhận tín hiệu. Chân 9 : Ring Indicate (RI) : Báo chuông cho biết là bộ nhận đang nhận tín hiệu rung chuông. 2.9 Triac: Hình 2.14. Sơ đồ chân BT138 Thường được coi như một SCR lưỡng hướng vì có thể dẫn điện theo hai chiều. Các thông số kỹ thuật của BT138: IGT:( dòng cổng kích khởi) cở 10mA đến 100mA Dòng đóng ILứng với VD = 12 V; IGT = 0.1 A khoảng từ 10mA- 60mA Dòng đi qua Triac cực đại là 12A Điện áp cực đại chịu đựng là : 600Vac 2.10 MOC3020: ......................................................... 5.5 Lưu đồ thuật toán bật hệ thống giám sát khi đi vắng: Bật hệ thống giám sát PIR Kết thúc check_pir==1 Hiển thị hệ thống cảnh báo, gởi tin nhắn về cho user Đ S Hình 5.7. Lưu đồ thuật toán chương trình bật PIR Giải thích: lưu đồ này cho phép chân PIR nhận dữ liệu vào PIC . Khi check_pir=1 thì vẫn chưa khởi động chuông hay có người thì cũng vậy. Khi nhắn tin tới thì cho phép Pir đổ dữ liệu vào pic. Thực ra pic hay pir vẫn đang hoạt động bình thường chỉ là mở khóa cho nó thôi. 5.6 Kết luận chương: Sau khi hoàn thành thi công, hệ thống gồm có 4 khối mạch, sau khi kiểm tra mạch, tất cả các khối đều hoạt động đúng chức năng và khá ổn định. Còn chương trình thì em đã xử lý được việc bật các kênh ADC thay phiên nhau và hiển thị nhiệt độ và GAS nếu hệ thống bất ổn định và đã gởi tin nhắn thành công về cho người dùng. Hệ thống đã được hoàn thành về cả phần cứng và phần mềm. Em đã kiểm tra hoạt động của thiết bị với điều kiện bình thường và khi có sự cố xảy ra. Về cơ bản, thiết bị đã đáp ứng và xử lý khá nhanh khi có sự cố nhiệt độ tăng cao bất thường hay có rò rỉ khí gas, VĐK đã kích hoạt ngay module sim gửi tin nhắn và gọi điện tới cho người sử dụng. KẾT LUẬN VÀ HƯỚNG PHÁT TRIỂN ĐỀ TÀI Kết luận: ĐỒ ÁN TỐT NGHIỆP ĐIỀU KHIỂN VÀ GIÁM SÁT HỆ THỐNG BÁO CHÁY TỪ XA BẰNG TIN NHẮN SMS Qua thời gian nghiên cứu, thi công đồ án đã cơ bản được hoàn thành. Bằng sự nỗ lực cố gắng của bản thân mỗi cá nhân và sự phân chia, phối hợp công việc hợp lí, chặt chẽ, nhịp nhàng giữa mỗi thành viên của nhóm, bên cạnh đó còn là sự hướng dẫn nhiệt tình, tận tâm của thầy Nguyễn Duy Nhật Viễn, đồ án này đã được hoàn thành đúng thời gian như đã định và đã đạt được yêu cầu đặt ra theo yêu cầu là thiết kế và thi công hệ thống điều khiển thiết bị từ xa qua tin nhắn SMS. Trong quá trình thực hiện đề tài, chúng em đã thu được những kết quả nhất định như sau: Mạch điện với các module nhỏ trên mạch được thiết kế, thi công hoàn chỉnh và đã được thử nghiệm nhiều lần và đã thoạt động ổn định trong thực tế. Xây dựng được mô hình để ứng dụng điều khiển các thiết bị và hệ thống báo động. Trong đồ án này, nhóm em đã trình bày khá đầy đủ về chức năng, cấu trúc của từng khối module nhỏ trên board mạch điện tích hợp. Như vậy, giúp người đọc có thể nắm bắt, hiểu được chức năng của từng module một cách dễ dàng. Bên cạnh đó, nội dung của đề tài được trình bày khá chi tiết rõ ràng bằng cách sử dụng những từ ngữ thông dụng, các hình ảnh đi kèm giúp người đọc dễ hiểu và có thể thực hiện một cách tương tự, đạt hiệu quả trong một thời gian ngắn. Hệ thống điều khiển thiết bị trong nhà từ xa thông qua tin nhắn SMS được thực hiện như trong đề tài là một hệ thống với các chức năng đạt được như sau: Hệ thống có thể điều khiển được thiết bị điện từ xa thông qua tin nhắn SMS: + Sau khi gửi tin nhắn thì với nội dụng tin nhắn đó, bộ xử lí sẽ thực thi quá trình xử lí, sau đó là điều khiển thiết bị một cách tự động. + Tin nhắn được gửi đi từ người điều khiển để điều khiển thiết bị điện và người điều khiển cũng nhận được tin nhắn trả ngược lại với nội dụng tin nhắn là đã điều khiển được các thiết bị hay chưa và hệ thống cảnh báo. + Hệ thống có khả năng được bảo vệ tốt, nghĩa là người sử dụng phải biết lệnh điều khiển và mật khẩu (password) thì mới đăng nhập được vào hệ thống đối với sử dụng tin nhắn SMS. Hệ thống có chức năng cảnh báo sự cố : + Khối thu phát hồng ngoại được thiết kế, lập trình kết hợp với trung tâm xử lí có khả năng gửi thông tin dữ liệu tới trung tâm xử lí. Ngoài ra còn có khả năng gửi tin nhắn ngược lại cho người điều khiển và tự động thi hành các thao tác được lập trình sẵn khi có báo động xảy ra. Để thực hiện được các chức năng nêu trên, nhóm em đã tìm hiểu, nghiên cứu các vấn đề có liên quan tới đề tài như : họ PIC16F887, Module Sim548, các ngôn ngữ lập trình tương ứng như CCS, bộ lệnh AT Command dành cho Module, và các vấn đề khác liên quan tới đề tài. Cuối cùng, theo nhận định chủ quan của nhóm em thì đồ án đã được hoàn thành đúng thời gian cho phép và đã trình bày khá đầy đủ các mảng kiến thức liên quan, các vấn đề liên qua tới đề tài. Song do những điều kiện khách quan, đề tài này chỉ thực hiện một phần nhỏ đối với việc điều khiển cho một ngôi nhà hoàn chỉnh. Đó là điều khiển thiết bị 1 thiết bị công suất và cảnh báo khi có người lạ vào nhà. Hướng phát triển đề tài Do thời gian thực hiện đề tài có hạn và lượng kiến thức cá nhân mỗi thành viên của nhóm là nhất định nên đề tài thực hiện xong chỉ đáp ứng được một phần nhỏ của một hệ thống hoàn chỉnh. Vì vậy, để đề tài này thêm phong phú hơn, mang nhiều tính thực tế hơn nữa, có khả năng ứng dụng cao hơn thì đề tài cần đưa thêm vào những yêu cầu như sau: Ngoài việc điều khiển giám sát bằng tin nhắn SMS, ta cũng có thể điều khiển Camera để chụp hình rồi sau đó gửi tin nhắn đa phương tiện đến điện thoại. Sử dụng thêm nhiều loại cảm biến khác, chẳng hạn như cảm biến nhiệt độ để đo nhiệt độ, cảm biến độ ẩm không khí để đo độ ẩm không khí, hệ thống báo cháy tự động,… để ứng dụng vào đề tài. Như thế người dùng có thể hình dung ra được toàn bộ không gian trong ngồi nhà. Mở rộng điều khiển được nhiều hơn nữa các thiết bị trong nhà. Phần cứng cho mỗi module cần được tách rời nhằm dễ dàng cho việc chỉnh sửa, thay đổi. Đề tài không những chỉ áp dụng cho với các tòa nhà mà nên được mở rộng áp dụng đối với điều khiển các thiết bị sử dụng nơi công cộng. Hy vọng với những hướng phát triển nêu trên cùng với những ý tưởng khác của các bạn, của người đọc- những người đi sau - sẽ phát triển hơn nữa đề tài này, khắc phục những hạn chế, tồn tại của đề tài, làm cho đề tài trở nên phong phú hơn, mang tính ứng dụng cao hơn vào trong thực tế cuộc sống, phục vụ cho những lợi ích của con người trong tương lai. Mã nguồn: #include #include #device *=16 ADC=10 #fuses NOWDT, HS, NOPUT, NOPROTECT, NODEBUG, NOBROWNOUT, NOLVP, NOCPD, NOWRT #use delay(clock=12000000) #use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7,bits=8,stop=1,parity=n,DISABLE_INTS #include #include #include #include #include void kiemtra(void); void read_sms(void); void ngatnhan(void); void test(void); void send_sms_help(); int8 buffer_gsm[90]="";
